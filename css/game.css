/* ===== Reset + blokady selekcji/long-press ===== */
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; -webkit-user-drag: none; }
html, body { margin:0; height:100%; background:#0b0c10; color:#e8eaed; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans"; }
body { overflow-x:hidden; touch-action:none; overscroll-behavior: none; }
button { font: inherit; }

:root{
  --app-vh: 100dvh;
  --pad-h-target: 26svh; --pad-h-min: 120px; --pad-h-max: 220px;
  --btn-alpha: .82; --btn-alpha-active: 1;
  --pad-offset: clamp(16px, 2.5vh, 32px);
  --pad-side-offset: 32px;
}

/* ===== Aplikacja: tylko obszar gry (gamepad = overlay) ===== */
.app{ position: fixed; inset: 0; height: var(--app-vh);
  padding: env(safe-area-inset-top) env(safe-area-inset-right) 0 env(safe-area-inset-left);
  display: grid; grid-template-rows: 1fr; contain: layout paint size; }
.stage-wrap{ position: relative; height: 100%; display: grid; place-items: center;
  background: radial-gradient(1200px 800px at 50% 50%, #11151a 0%, #0b0c10 60%, #08090c 100%); overflow: hidden; }
canvas#stage{ width: 100%; height: 100%; display:block; image-rendering: pixelated; image-rendering: crisp-edges; }

/* ===== Overlay (Start / Rotate) ===== */
.overlay{ position: fixed; inset: 0; display:grid; place-items:center; background: rgba(0,0,0,.6);
  transition: opacity .25s ease; z-index: 9999;
  padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left); }
.overlay.hidden{ opacity:0; pointer-events:none; }
.overlay .card{ text-align:center; background: rgba(20,25,33,.9); border:1px solid #273244; border-radius:12px; padding:18px 20px;
  width:min(90vw,520px); max-height:82dvh; overflow:auto; box-shadow:0 10px 30px rgba(0,0,0,.35); }
.overlay h1{ margin:0 0 .25rem; font-size: clamp(18px, 3vw, 24px); }
.overlay p{ margin:.25rem 0 .75rem; color:#c7d2fe; font-size:clamp(14px,2.3vw,16px); opacity:.9; }
.overlay .bigbtn{ display:inline-block; padding:.8rem 1.2rem; border-radius:999px; border:1px solid #334155;
  background:linear-gradient(#1e293b,#0f172a); color:#e5e7eb; text-transform:uppercase; letter-spacing:.06em; font-weight:600; }

.bigbtn { touch-action: manipulation; }

/* ===== Gamepad: overlay, transparent BG ===== */
.controls{ position: fixed; left:0; right:0; bottom:0;
  height: clamp(var(--pad-h-min), var(--pad-h, var(--pad-h-target)), var(--pad-h-max));
  display: grid !important; grid-template-columns: auto 1fr auto; align-items: end; gap: 1rem;
  padding: .5rem 1rem calc(env(safe-area-inset-bottom) + .75rem); background: transparent !important;
  z-index: 1000; pointer-events: auto; transform: translateY(calc(-1 * var(--pad-offset))); }
.dpad{ justify-self:start; height: var(--pad-h, var(--pad-h-target)); width: var(--pad-h, var(--pad-h-target));
  display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); grid-template-rows: repeat(3, minmax(0,1fr));
  grid-template-areas: ". up ." "left center right" ". down .";
  gap:.5rem; user-select:none; touch-action:none; transform: translateX(var(--pad-side-offset)); }
.dpad .up{grid-area:up} .dpad .down{grid-area:down} .dpad .left{grid-area:left} .dpad .right{grid-area:right}
.dpad .center{grid-area:center; opacity:.35; pointer-events:none;}

.dpad button, .menu .pill, .ab button{
  background: linear-gradient(180deg, rgba(15,23,42,var(--btn-alpha)), rgba(17,24,39,var(--btn-alpha))) !important;
  border: 1px solid rgba(51,65,85,.55) !important;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.05), 0 4px 12px rgba(0,0,0,.22) !important;
  color:#e5e7eb; font-weight:700; padding:0; display:grid; place-items:center; touch-action:manipulation; }
.dpad button:active, .dpad button[data-active="true"], .ab button:active, .ab button[data-active="true"], .menu .pill:active, .menu .pill[data-active="true"]{
  transform: translateY(1px); filter:brightness(1.15); outline:none;
  background: linear-gradient(180deg, rgba(15,23,42,var(--btn-alpha-active)), rgba(17,24,39,var(--btn-alpha-active))) !important; }

.menu{ align-self:end; justify-self:center; display:grid; gap:.5rem; place-items:center; min-width:11rem; }
.menu-row{ display:grid; grid-template-columns:1fr 1fr; gap:.6rem; width:clamp(180px,20vw,260px); }
.menu .pill{ padding:.6rem .8rem; text-transform:uppercase; letter-spacing:.08em; font-size:.9rem; }

.ab{ justify-self:end; width: calc(var(--pad-h, var(--pad-h-target)) * 0.95); height: calc(var(--pad-h, var(--pad-h-target)) * 0.8);
  position:relative; transform: translateX(calc(-1 * var(--pad-side-offset))); }
.ab button{ position:absolute; width:36%; aspect-ratio:1/1; border-radius:50%;
  background: radial-gradient(circle at 30% 25%, rgba(51,65,85,var(--btn-alpha)), rgba(15,23,42,var(--btn-alpha)) 60%) !important;
  border: 1px solid rgba(71,85,105,.55) !important; font-weight:800; font-size: clamp(14px, 2.5vw, 18px); }
.ab .btn-b{ left:8%;  bottom:8%; } .ab .btn-a{ right:8%; top:8%; }

@media (orientation: portrait){ .rotate-hint{ display:grid !important; } }
.rotate-hint{ display:none; }
@media (pointer:fine){ .controls{ max-width:1200px; margin:0 auto; } }
body.pseudo-fs .app { height: 100dvh; }

@font-face{
  font-family: "EarlsRevenge";
  src: url("../assets/fonts/EarlsRevenge-69Kg.ttf") format("truetype");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

/* Zmienna z fontem i globalne użycie */
:root { --game-font: "EarlsRevenge", system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans"; }

body,
.overlay .card,
.dialog,
.controls button { font-family: var(--game-font); }

/* (opcjonalnie) drobny tracking – ten font lubi minimalny letter-spacing */
.dialog .text { letter-spacing: .2px; }

.dialog {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  /* bottom ustawimy z JS, tu tylko awaryjnie: */
  bottom: 24px;

  /* STAŁA SZEROKOŚĆ, nie „rozpycha się” z tekstem */
  width: min(92vw, 560px);
  min-height: 88px;

  background: rgba(15,23,42,.95);
  border: 1px solid #334155;
  border-radius: 12px;
  padding: 12px 14px;
  box-shadow: 0 10px 30px rgba(0,0,0,.35);
  z-index: 2000;
}
.dialog .name { font-weight:700; color:#93c5fd; margin-bottom:6px; font-size:14px; }
.dialog .text { font-size:15px; color:#e5e7eb; line-height:1.35; white-space:pre-wrap; word-break:break-word; }
.dialog .hint { margin-top:8px; font-size:12px; color:#94a3b8; text-align:right; }